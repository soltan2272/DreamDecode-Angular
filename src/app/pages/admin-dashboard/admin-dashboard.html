<div class="container py-4">
  <h2 class="mb-3">لوحة تحكم الأدمن</h2>

  <div class="row g-4">
    <!-- Admins list -->
    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Admins</strong>
          <!-- trigger add modal -->
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addAdminModal">Add Admin</button>
        </div>
        <div class="card-body p-0">
          <ul class="list-group list-group-flush">
            <li *ngFor="let a of admins" class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-bold">{{ a.fullName }}</div>
                <small class="text-muted">{{ a.email }}</small>
              </div>
              <div>
                <button class="btn btn-sm btn-danger" (click)="confirmDeleteAdmin(a.email)">حذف</button>
              </div>
            </li>
            <li *ngIf="admins.length === 0" class="list-group-item text-muted">لم يوجد مفسرين حتي الان</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Pending dreams -->
    <div class="col-lg-7">
      <div class="card shadow-sm">
        <div class="card-header"><strong>الاحلام التي لم تفسر بعد</strong></div>
        <div class="card-body">
          <div *ngIf="pendingDreams.length === 0" class="text-muted">لا يوجد</div>
          <div *ngFor="let d of pendingDreams" class="mb-3 border rounded p-3">
            <div class="d-flex justify-content-between">
              <div>
                <div class="fw-bold">{{ d.title }}</div>
                <small class="text-muted">from: {{ d.userId }} • {{ d.submittedAt | date:'short' }}</small>
              </div>
              <div>
                <button class="btn btn-sm btn-outline-primary me-2" (click)="openInterpretModal(d.dreamId)">Interpret</button>
              </div>
            </div>
         <div class="mt-2 text-muted">
  {{ d.description | slice:0:200 }}
  {{ d.description!.length > 200 ? '...' : '' }}
</div>



        </div>
      </div>
    </div>
  </div>

  <!-- My interpretations -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header"><strong>تفسيراتي</strong></div>
    <div class="card-body">
      <div *ngIf="myInterpretations.length === 0" class="text-muted">No interpretations yet</div>
      <div *ngFor="let it of myInterpretations" class="border rounded p-3 mb-2">
        <div class="fw-bold">حلم #{{ it.dreamId }} — {{ it.interpretedAt }}</div>
        <div class="text-muted">{{ it.interpretationText }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Add Admin Modal -->
<div class="modal fade" id="addAdminModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Add Admin</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form #addAdminForm="ngForm" (ngSubmit)="submitAddAdmin()">
          <div class="mb-2">
            <label class="form-label">Full Name</label>
            <input name="fullName" class="form-control" [(ngModel)]="addAdminModel.fullName" required />
          </div>
          <div class="mb-2">
            <label class="form-label">Email</label>
            <input name="email" class="form-control" type="email" [(ngModel)]="addAdminModel.email" required />
          </div>
          <div class="mb-2">
            <label class="form-label">Password</label>
            <input name="password" class="form-control" type="password" [(ngModel)]="addAdminModel.password" required />
          </div>

          <div *ngIf="addAdminError" class="text-danger mb-2">{{ addAdminError }}</div>
          <div *ngIf="addAdminSuccess" class="text-success mb-2">{{ addAdminSuccess }}</div>

          <button class="btn btn-primary w-100" type="submit" [disabled]="loading">{{ loading ? 'Adding...' : 'Add Admin' }}</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Interpret Modal -->
<div class="modal fade" id="interpretModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title">Add Interpretation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="submitInterpretation($event.target)" #interpForm="ngForm">
          <div class="mb-3">
            <label class="form-label">Interpretation</label>
            <textarea class="form-control" rows="6" [(ngModel)]="interpText" name="interpText" required></textarea>
          </div>
          <div *ngIf="interpError" class="text-danger">{{ interpError }}</div>
          <button class="btn btn-primary">Save Interpretation</button>
        </form>
      </div>
    </div>
  </div>
</div>
